package ca.mcgill.ecse211.lab4;

import static ca.mcgill.ecse211.lab4.Resources.*;
import lejos.hardware.ev3.LocalEV3;
import lejos.hardware.port.Port;
import lejos.hardware.sensor.EV3ColorSensor;
import lejos.hardware.sensor.SensorModes;
import lejos.robotics.SampleProvider;

public class LightLocalizer {

  private static final Port colourSampler = LocalEV3.get().getPort("S2");
  private SensorModes colourSamplerSensor = new EV3ColorSensor(colourSampler);
  private SampleProvider colourSensorValue = colourSamplerSensor.getMode("Red");
  private float[] colourSensorValues = new float[colourSamplerSensor.sampleSize()];

  public void localize() {
    
  }
  
  public void goToOrigin() {
    
  }
  
  public void turnTo(double theta) {

    leftMotor.setSpeed(ROTATE_SPEED);
    rightMotor.setSpeed(ROTATE_SPEED);

    double turnAngle = getMinAngle(theta - Math.toRadians(odometer.getXYT()[2]));

    leftMotor.rotate(radToDeg(turnAngle), true);
    rightMotor.rotate(-radToDeg(turnAngle), false);
  }
  
  private float readColorData() {
    colourSensorValue.fetchSample(colourSensorValues, 0);
    return (colourSensorValues[0] * 1000);
  }

  private int distanceToRotations(double distance) {
    return (int) (180.0 * distance / (Math.PI * WHEEL_RAD));
  }

  private int radToDeg(double angle) {
    return distanceToRotations(TRACK * angle / 2);
  }
  
  public double getMinAngle(double angle) {
    if (angle > Math.PI) {
      angle -= 2 * Math.PI;
    } else if (angle < -Math.PI) {
      angle += 2 * Math.PI ;
    }
    return angle;
  }

}
